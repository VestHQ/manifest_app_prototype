<script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
</script>
<script src="https://code.jquery.com/ui/1.12.0/jquery-ui.min.js" integrity="sha256-eGE6blurk5sHj+rmkfsGYeKyZx3M4bG+ZlFyA7Kns7E=" crossorigin="anonymous">
</script>

<script>
    /*TODO
    * have typing animation
    * expand to text message
    * move user img to just below previous message
    * repeat typing animation then msg expanding animation again
    * typing
    * expand msg
    * user img down
    * typing
    *
    * i want to transform typing into msgExpand
    * one animates the dots
    * the other animates the message bubble
    *
    * if (typing animation is complete)
    * -> expand to message
    *
    * turn element into another element? or just toggle?
    * */

    // const msg = document.getElementById('msg');
    // const typing = document.getElementById('typing');
    //
    // // document.addEventListener('animationend', function() {
    // //     console.log("animation stopped", event);
    // // });
    //
    // let myEndFunction = function () {
    //     console.log("animation stopped")
    // };
    //
    // typing.addEventListener("webkitAnimationEnd", myEndFunction);

    // msg.onanimationend = function(event) {
    //     console.log("message animation stopped", event);
    // };

    var chatMessages = [{
        type: "text",
        name: "ms1",
        msg: "Hi! I'm Henry, and I'm here to assist your transfer.",
        delay: 300,
        align: "left",
    },
        {
            type: "text",
            name: "ms2",
            msg: "Nice work on choosing to rollover your retirement. Moving your money to a plan appropriate for your employment situation is the best way to keep your retirement fund healthy, and growing!",
            delay: 800,
            align: "left",
        },
        {
            type: "text",
            name: "ms3",
            msg: "Are you currently employed by UoC?",
            delay: 1000,
            align: "left",
        },
        {
            type: "input",
            align: "right",
            input: { type: "text" }
        },
        {
            type: "input",
            align: "right",
            input: { type:"buttons", buttons: [ "Yes", "No"] },
        }
    ];
    var currentMessage = 0;
    var chatDelay = 0;

    function postMessage(alignment, text) {
        $(".chat-message-list").append("<li class='message-'" + alignment + ">" + text + "</li>");
    }

    function showInputBox() {
        $(".chat-message-list").append("<input type='text'>");
    }
    function showInputButtons(button_names) {
        $(".chat-message-list").append("<div class='btn-container'>" + "<button class='btn'>" + "Yes" + "</button>" + "<button class='btn'>" + "No" + "</button>" + "</div>");
    }

    function processCurrentMessage() {
        if (currentMessage >= chatMessages.length) {
            return;
        }

        const msg = chatMessages[currentMessage++]; //incriment msg so it doesnt repeat from beginning each time its called
        switch (msg.type) {
            case "text":
                postMessage(msg.align, msg.msg);
                // setup a timer which will call processCurrentMessage() after a delay message.delay
                setTimeout(processCurrentMessage, msg.delay);
                break;
            case "input":
                switch (msg.input.type) {
                    case "text":
                        showInputBox();
                        break;
                    case "buttons":
                        showInputButtons(msg.input.buttons);
                        break;
                }
                // do nothing, wait for the user to input/respond. when they do (on button click) call processCurrentMessage();
                break;
        }
    }

    processCurrentMessage();

    // for each msg in the list {
    //   switch (msg.type) {
    //     case "text":
    //       do what you do now
    // .     break;
    //     case "input":
    // .     switch (msg.input.type) {
    //         case "text":
    //           show the text input, box wait for input
    // .        break;
    //         case "buttons":
    //           show panel with buttons, box wait for input
    //           use buttons names from the msg.input.buttons field
    // .        break;
    //       }
    // .     break;
    //   }
    //

    // 1. Add input field
    // 2. Add support for mess
</script>